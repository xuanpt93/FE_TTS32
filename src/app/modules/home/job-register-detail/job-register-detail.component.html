<div class="container">
  <div class="d-flex my-3">

    <button type="button" (click)="downloadCV(data.cv)" class="btn btn-success" style="margin-right: 1px;">Tải CV</button>

    <div *ngIf="data.statusJobRegister.code === 'P_WAITING'">
      <form (ngSubmit)="onChangeStatus(data.id, $event)" [formGroup]="formChangeStatus">
        <input type="hidden" name="status" value="P_APPROVED" />
        <input type="hidden" value="" name="reason"/>
        <button type="submit" class="btn btn-success" style="margin-right: 1px;">Xét duyệt</button>
      </form>
    </div>

    <div *ngIf="data.statusJobRegister.code === 'P_WAITING' || data.statusJobRegister.code === 'P_APPROVED' || data.statusJobRegister.code === 'P_INTERVIEW'">
        <button type="button" data-bs-toggle="modal" data-bs-target="#myModal" class="btn btn-success" style="margin-right: 1px;">Từ chối ứng viên</button>

      <form (ngSubmit)="onChangeStatus(data.id, $event)" [formGroup]="formChangeStatus">

        <input type="hidden" name="status" value="P_REJECT" />
        <div class="modal" id="myModal">
          <div class="modal-dialog">
            <div class="modal-content">
              <!-- Modal Header -->
              <div class="modal-header">
                <h4 class="modal-title">Lý do từ chối</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <!-- Modal body -->
              <div class="modal-body">
                <div class="col-auto">
                  <textarea name="reason" [rows]="5" [cols]="50" pInputTextarea autoResize="autoResize"></textarea>
                </div>
              </div>
              <div class="col alert alert-danger" role="alert"
                   *ngIf="formChangeStatus.get('reason')?.errors?.required && formChangeStatus.get('reason')?.touched">
                Reason is required!
              </div>
              <!-- Modal footer -->
              <div class="modal-footer">
                <button type="submit"  class="btn btn-success" data-bs-dismiss="modal" style="margin-right: 1px;">submit</button>
                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

      </form>
    </div>

    <div *ngIf="data.statusJobRegister.code === 'P_REJECT' || data.statusJobRegister.code === 'P_REJECT_INTERVIEW'">
      <button  type="button" (click)="openPopup()" class="btn btn-success" style="margin-right: 1px;">Xem lý do</button>

      <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayStyle}">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Lý do từ chối</h4>
            </div>
            <div class="modal-body">
              <p>{{data.reason}}</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-danger" (click)="closePopup()">
                Close
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div *ngIf="data.statusJobRegister.code === 'P_APPROVED'">
      <button type="button" (click)="openPopup1(data)" class="btn btn-success" style="margin-right: 1px;">Đặt lịch phỏng vấn</button>

      <div class="modal" tabindex="-1" role="dialog" [ngStyle]="{'display':displayStyle1}">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Đặt lịch phỏng vấn</h4>
            </div>
            <div class="modal-body">
              <form [formGroup]="formInterview">
                <input type="hidden" formControlName="userId" value="{{data.user.id}}" />
                <input type="hidden" formControlName="jobRegisterId" value="{{data.id}}" />
                <div class="col-md-12">
                  <label >Thời gian phỏng vấn:</label>
                  <p-calendar formControlName="date" [showTime]="true" [showIcon]="true" [minDate]="currentDate" inputId="time"></p-calendar>
                </div>

                <div class="col alert alert-danger" role="alert"
                     *ngIf="formInterview.get('date')?.errors?.required && formInterview.get('date')?.touched">
                  Date is required!
                </div>


                <div class="col-md-6">
                  <label >Hình thức phỏng vấn:</label>
                  <mat-radio-group aria-label="Select an option" >
                    <mat-radio-button formControlName="method" value="offline" style="margin-right: 5px;" (change) ="closeCombobox()">Offline</mat-radio-button>
                    <mat-radio-button formControlName="method" value="online" (change) ="openCombobox()">Online</mat-radio-button>
                    <div [ngStyle]="{'display': licensed}">
                      <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example" formControlName="tools" >
                        <option value="Skype">Skype</option>
                        <option value="Google meet">Google meet</option>
                        <option value="Classroom">Classroom</option>
                      </select>
                    </div>
                  </mat-radio-group>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button  class="btn btn-primary" (click)="onSubmit()" type="submit">Submit</button>
              <button type="button" class="btn btn-danger" (click)="closePopup1()">
                Close
              </button>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div *ngIf="data.statusJobRegister.code === 'P_INTERVIEW'">
      <form (ngSubmit)="onChangeStatus(data.id, $event)" [formGroup]="formChangeStatus">
        <input type="hidden" name="status" value="P_SUCCESS" />
        <input type="hidden" value="" name="reason"/>
        <button type="submit" (click)="openPopup1(data)" class="btn btn-success" style="margin-right: 1px;">Tuyển thành công</button>
      </form>
    </div>

    <div *ngIf="data.statusJobRegister.code === 'P_INTERVIEW'">
      <form (ngSubmit)="onChangeStatus(data.id, $event)" [formGroup]="formChangeStatus">
        <input type="hidden" name="status" value="P_REJECT_INTERVIEW" />
        <input type="hidden" value="" name="reason"/>
        <button type="submit"  class="btn btn-success" style="margin-right: 1px;">Từ chối phỏng vấn</button>
      </form>
    </div>

    <div *ngIf="data.statusJobRegister.code === 'P_INTERVIEW'">
      <form (ngSubmit)="onChangeStatus(data.id, $event)" [formGroup]="formChangeStatus">
        <input type="hidden" name="status" value="P_LOST" />
        <input type="hidden" value="" name="reason"/>
        <button type="submit" class="btn btn-success" style="margin-right: 1px;">Từ chối tuyển dụng</button>
      </form>
    </div>

  </div>

  <strong style="font-size: larger" class="my-5">Thông tin chung</strong>
  <div class="box-main d-flex justify-content-between p-5">
    <div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/2.svg" alt="">
        <div>
          <strong>Tên công việc </strong> <br>
          <span>{{data.job.name}}</span>
        </div>
      </div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/1.svg" alt="">
        <div>
          <strong>Mức lương </strong> <br>
          <span>{{data.job.salaryMin}}-{{data.job.salaryMax}} triệu</span>
        </div>
      </div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/5.svg" alt="">
        <div>
          <strong>Số lượng tuyển </strong> <br>
          <span>{{data.job.qtyPerson}} người</span>
        </div>
      </div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/2.svg" alt="">
        <div>
          <strong>Hình thức làm việc </strong> <br>
          <span>{{data.job.jobPosition.code}}</span>
        </div>
      </div>
    </div>
    <div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/6.svg" alt="">
        <div>
          <strong>Tên người ứng tuyển </strong> <br>
          <span>{{data.user.name}}</span>
        </div>
      </div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/6.svg" alt="">
        <div>
          <strong>Cấp bậc </strong> <br>
          <span>{{data.job.rank.code}}</span>
        </div>
      </div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/3.svg" alt="">
        <div>
          <strong>Giới tính </strong> <br>
          <span>Không yêu cầu</span>
        </div>
      </div>
      <div class="box-item d-flex mt-3">
        <img class="mr-3" src="https://www.topcv.vn/v4/image/job-detail/icon/7.svg" alt="">
        <div>
          <strong>Kinh nghiệm </strong> <br>
          <span>{{data.job.numberExperience}} năm</span>
        </div>
      </div>
    </div>
  </div>
</div>


